# Design

## ドキュメント

### ソースコードファースト

ドキュメントの可読性の基準はソースコード(Markdownテキスト)でありレンダリング後の可読性はオプションである。
よって構文はレンダリングを要さず直接意味づけの役割を果たさなければならない。

ゆえにすべての構文は直感に従い意味を解釈できる。

### サードパーティドキュメントの共有および表示可能性

ドキュメントはそのセキュリティ上の信頼性にかかわらず共有および表示できなければならない。
よってパーサーおよびレンダラーはXSSをはじめとする悪意あるコードの注入に対して安全でなければならない。

ゆえにパーサーは設計レベルでXSS安全である。
ただし外部メディアの表示等安全性を外部サービスに依存する部分はこの限りではない。

## 書式

### ソースコードの書式および可読性の統一

構文はソースコードの書式を画一化し統一的な可読性を与える制約的なものでなければならない。
よってソースコードはレンダリング結果から一意に定まらなければならない。

ゆえにブロックレベルの構文は空行の挿入によるブロックごとの分割を必須とし、レイアウトのための空行を無視する。

### Diffの形成

構文はDiffを取る範囲の改行による制御を阻害してはならない。

ゆえに構文はソースコードの改行をレンダリング結果の制御に用いない。

### 行内文字数制限

構文は行の文字数制限を阻害してはならない。

ゆえにリンク構文(`[]()`)は改行によりテキストとURLを異なる行に分割する拡張構文(`[]\n()`)を備える。
メディア構文(`![]()`)も同様である。

## 構文

### 引用のコピペビリティ

引用構文はコピー&ペーストにより挿入されたテキストを無編集で使用できなければならない。

ゆえに引用構文は引用文をパースしない。

### 附番制の不採用

附番を伴う脚注構文は参照と実体を対応させる附番の管理が困難であるため不採用とする。

ゆえに参照箇所に実体を記述する注釈構文を代替構文として採用し、その表示方法は任意である。

### 羅列的知識への非依存

構文はその使用のために羅列的知識を必要としてはならない。

ゆえに構文はHTMLエンティティの参照の有効性を検査しない。

### 編集中のソースコードのレンダリング結果の表示安定性

レンダリング結果の表示はソースコードの編集にともなう高頻度または広範囲にわたる変化により視覚的負担をかけてはならない。
よって構文は編集過程で生じる不完全な構文を最大限補完してパースしなければならない。

ゆえにすべてのブロックレベルの構文は順次的な編集過程で生じるすべての不完全な構文を補完してパースする。
またインラインのレンダリングはキャッシュにより省略される。

## スケーラビリティ

パーサーおよびレンダラーはドキュメントのサイズにより以下の利用性を損なってはならない。

### 閲覧性

ドキュメントは即座ないし順次閲覧できなければならない。
よってドキュメントは全体のパースを待たず一定時間内に表示を開始しなければならない。
また高価な処理は必要時まで遅延しなければならない。

ゆえにパーサーはパースおよびその結果の返却を逐次的に行う。
またパーサーは外部リソースのリクエストその他の高価な処理を行わずレンダラーに委ねる。

### 参照性

ドキュメントは各記述への参照、参照先への移動、および参照元への復帰方法を提供しなければならない。

ゆえにドキュメントはすべてのセクションおよび用語に任意のインデクスを定義およびリンクにより参照できる。
また注釈も同じく参照できなければならない。

### 編集性

ドキュメントはそのサイズにかかわらず編集が容易でなければならない。
よってパースおよびレンダリングは差分更新により行わなければならない。

ゆえにパーサーは差分更新を行い、構文はこのために空行によるブロックの分割を必須とする。
